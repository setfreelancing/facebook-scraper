import datetime
from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import pandas as pa
import time
import os 


mainUrl = 'https://www.facebook.com/iietofficial2'
chrome_options = webdriver.ChromeOptions()
prefs = {"profile.default_content_setting_values.notifications" : 2}
chrome_options.add_experimental_option("prefs",prefs)
driver = webdriver.Chrome(r'D:\chromedriver.exe',chrome_options=chrome_options)

try:
    driver.get("https://www.facebook.com")
    username = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.CSS_SELECTOR, "input[name='email']")))
    password = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.CSS_SELECTOR, "input[name='pass']")))
    time.sleep(3)
    username.clear()
    username.send_keys("majholmeme@gmail.com")
    time.sleep(2)
    password.clear()
    password.send_keys("mhmdashek445")
    time.sleep(2)
    button = WebDriverWait(driver, 20).until(EC.element_to_be_clickable((By.CSS_SELECTOR, "button[type='submit']"))).click()
    time.sleep(5)
    driver.get(mainUrl)
    divexist = WebDriverWait(driver, 20).until(EC.presence_of_element_located((By.CSS_SELECTOR, "div[class='ihqw7lf3']")))    
    driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")
    time.sleep(2)
    elements = WebDriverWait(driver, 20).until(EC.presence_of_element_located((By.CSS_SELECTOR, "div[class='s9t1a10h']")))
    elements =  driver.find_element(By.XPATH, "//div[@class='s9t1a10h']//span[@dir='auto']")
    print("created_at")
    print("===>",elements.get_attribute('innerHTML'))
    driver.get(mainUrl+'/about/?ref=page_internal')
    elements = WebDriverWait(driver, 20).until(EC.presence_of_element_located((By.CSS_SELECTOR, "div[class='je60u5p8']")))
    alldivs = driver.find_elements(By.CLASS_NAME, 'je60u5p8')
    datarow = []
    colomns = []
    for i in alldivs:        
        isfirst = True
        firstdiv =""
        space = ""
        titledivs = i.find_elements(By.XPATH, ".//span[@dir='auto']") 
     
        for v in titledivs:
            print(space,v.text)
            if (isfirst):
                isfirst = False
                space = "===>"
                firstdiv = v.text
            else:
                datarow.append([v.text,firstdiv])
        
except Exception as e:
    print('error: ',e)
driver.close()
driver.quit()


dt_f = pa.DataFrame(data=datarow,columns=['Text','Parent'])
desktop = os.path.join(os.path.join(os.environ['USERPROFILE']), 'OneDrive') + '\Desktop'
isExist = os.path.exists(desktop)
csvpath = os.path.join(desktop,str(int(round(datetime.datetime.timestamp(datetime.datetime.now())))))+'.csv'
dt_f.to_csv(csvpath,index=False)
